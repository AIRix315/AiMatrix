# 架构设计文档 v1.0.0

## 版本记录

| 版本 | 日期 | 变更类型 | 变更内容 |
|------|------|----------|----------|
| 1.0.0 | 2025-12-22 | 初始版本 | 创建架构设计文档，包含系统概述、核心架构、数据流设计、安全设计和性能优化策略 |

## 全局要求

**重要提醒：本文档遵循全局时间处理要求，任何涉及时间的操作必须先查询系统时间或使用MCP服务确认后方可执行。详细规范请参考 [00-global-requirements-v1.0.0.md](00-global-requirements-v1.0.0.md)**

## 系统概述

本系统是一个基于Electron的AI视频生成工作流管理平台，定位为中间件，不直接参与视频渲染，而是提供统一的工作流管理和物料管理功能。

## 核心架构

### 主进程架构

#### 文件系统管理器
- 项目文件夹结构管理
- JSON/文本文件读写操作
- 物料文件索引维护
- 文件监听与同步机制

#### 工作流适配器
- ComfyUI API适配器
- N8N API适配器
- MCP服务接口
- 统一工作流抽象层

#### 本地服务管理器
- 本地API调用管理
- MCP服务生命周期管理
- 服务状态监控
- 资源分配优化

### 渲染进程架构

#### 用户界面模块
- 文件浏览器组件
- 物料管理界面
- 工作流配置界面
- 预览窗口组件

#### 数据管理模块
- 本地状态管理
- 文件数据缓存
- 配置数据持久化
- 实时数据同步

## 数据流设计

### 项目文件结构
```
/project-name/
├── materials/
│   ├── texts/
│   ├── images/
│   └── videos/
├── workflows/
│   ├── comfyui/
│   └── n8n/
├── config/
│   ├── project.json
│   └── assets.json
└── logs/
    └── workflow.log
```

### 数据交互流程
1. 用户操作触发事件
2. 渲染进程发送IPC消息
3. 主进程处理业务逻辑
4. 文件系统或API调用
5. 结果返回渲染进程更新UI

## 技术栈选择

### 核心技术
- Electron 25+
- Node.js 18+
- TypeScript 5+
- React 18+

### 开发工具
- Webpack 5
- ESLint + Prettier
- Jest (单元测试)
- Electron Builder (打包)

## 安全设计

### API密钥管理
- 系统密钥链存储
- 加密传输
- 访问权限控制

### 文件安全
- 沙箱文件访问
- 路径遍历防护
- 文件类型验证

## 性能优化

### 内存管理
- 懒加载机制
- 缓存策略
- 垃圾回收优化

### 文件操作
- 异步I/O操作
- 批量处理
- 进度反馈

## 扩展性设计

### 插件系统
- 插件接口定义
- 动态加载机制
- 权限控制

### 工作流扩展
- 适配器模式
- 配置驱动
- 热更新支持